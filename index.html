<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notion Habit Tracker</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <style>
        /* --- 1. CSS Variables & Themes --- */
        :root {
            --bg-color: #fff0f3;
            --card-bg: #ffffff;
            --text-main: #4a4a4a;
            --text-sub: #888888;
            --accent-color: #ff8fa3; /* Default Rose */
            --accent-light: #ffe0e6;
            --shadow: 0 4px 15px rgba(0,0,0,0.05);
            --radius: 16px;
            --font-family: 'Poppins', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
        }

        /* Theme Classes */
        body.theme-lavender { --bg-color: #f3f0ff; --accent-color: #b39ddb; --accent-light: #ede7f6; }
        body.theme-mint { --bg-color: #e0f2f1; --accent-color: #80cbc4; --accent-light: #e0f2f1; }
        body.theme-peach { --bg-color: #fff3e0; --accent-color: #ffcc80; --accent-light: #fff3e0; }

        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0;
            padding: 10px;
            font-family: var(--font-family);
            background-color: var(--bg-color);
            color: var(--text-main);
            height: 100vh;
            overflow: hidden; /* 스크롤은 내부 컨테이너에서 처리 */
            transition: background-color 0.3s ease;
        }

        /* --- 2. Layout --- */
        .container {
            max-width: 600px;
            margin: 0 auto;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 5px;
            margin-bottom: 10px;
        }

        h1 { margin: 0; font-size: 1.2rem; font-weight: 600; color: var(--text-main); }
        .date-display { font-size: 0.8rem; color: var(--text-sub); margin-top: 2px; }

        .header-icons i {
            font-size: 1.5rem;
            cursor: pointer;
            margin-left: 12px;
            color: var(--text-sub);
            transition: color 0.2s;
        }
        .header-icons i:hover { color: var(--accent-color); }

        /* --- 3. Habit List --- */
        .habit-list {
            flex: 1;
            overflow-y: auto;
            padding: 5px;
            /* 스크롤바 숨기기 */
            -ms-overflow-style: none; scrollbar-width: none;
        }
        .habit-list::-webkit-scrollbar { display: none; }

        .habit-card {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 15px;
            margin-bottom: 12px;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: transform 0.2s ease, opacity 0.3s;
        }
        
        .habit-card:hover { transform: translateY(-2px); }

        .habit-info { display: flex; align-items: center; gap: 12px; flex: 1; }
        .habit-icon { color: var(--accent-color); font-size: 1.4rem; }
        
        .habit-text { display: flex; flex-direction: column; }
        .habit-name { font-size: 0.95rem; font-weight: 500; }
        .habit-meta { font-size: 0.75rem; color: var(--text-sub); }

        /* Checkbox & Actions */
        .check-btn {
            width: 28px;
            height: 28px;
            border: 2px solid var(--accent-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            background: transparent;
            color: white;
            transition: all 0.2s;
        }

        .habit-card.completed .check-btn {
            background: var(--accent-color);
        }
        
        .habit-card.completed .habit-name {
            text-decoration: line-through;
            color: var(--text-sub);
        }

        .delete-btn {
            font-size: 1.2rem;
            color: #e0e0e0;
            cursor: pointer;
            margin-left: 10px;
            opacity: 0; /* 호버 시 보임 */
            transition: opacity 0.2s;
        }
        .habit-card:hover .delete-btn { opacity: 1; }
        .delete-btn:hover { color: #ff6b6b; }

        /* Counter Controls (for N times a week) */
        .counter-controls { display: flex; align-items: center; gap: 8px; }
        .count-btn {
            width: 24px; height: 24px; background: var(--accent-light);
            color: var(--accent-color); border-radius: 50%; border: none;
            cursor: pointer; font-weight: bold; display: flex; align-items: center; justify-content: center;
        }

        /* --- 4. Popups (Modals) --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255, 0.6);
            backdrop-filter: blur(4px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        .modal-overlay.active { display: flex; }

        .modal-content {
            background: white;
            padding: 25px;
            border-radius: 20px;
            width: 90%;
            max-width: 350px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        h2 { font-size: 1.1rem; margin-top: 0; color: var(--accent-color); }
        
        label { display: block; font-size: 0.8rem; color: var(--text-sub); margin-bottom: 5px; margin-top: 15px; }
        input[type="text"], select {
            width: 100%; padding: 10px; border: 1px solid #eee; border-radius: 10px;
            background: #f9f9f9; font-family: var(--font-family);
        }

        .days-selector { display: flex; gap: 5px; margin-top: 5px; }
        .day-chk { display: none; }
        .day-label {
            width: 30px; height: 30px; border-radius: 50%; background: #eee;
            display: flex; align-items: center; justify-content: center;
            font-size: 0.7rem; cursor: pointer; color: #aaa;
            transition: all 0.2s;
        }
        .day-chk:checked + .day-label { background: var(--accent-color); color: white; }

        .btn-group { margin-top: 25px; display: flex; gap: 10px; }
        .btn { flex: 1; padding: 12px; border: none; border-radius: 10px; cursor: pointer; font-weight: 600; font-family: var(--font-family); }
        .btn-primary { background: var(--accent-color); color: white; }
        .btn-cancel { background: #f0f0f0; color: var(--text-sub); }

        /* Theme Selector Circles */
        .theme-options { display: flex; gap: 15px; margin-top: 10px; justify-content: center;}
        .theme-circle { width: 35px; height: 35px; border-radius: 50%; cursor: pointer; border: 2px solid transparent; }
        .theme-circle.selected { border-color: var(--text-main); transform: scale(1.1); }

    </style>
</head>
<body>

<div class="container">
    <header>
        <div>
            <h1 id="greeting">Today's Habits</h1>
            <div class="date-display" id="currentDate">Loading date...</div>
        </div>
        <div class="header-icons">
            <i class="ph ph-paint-brush-broad" onclick="openThemeModal()"></i>
            <i class="ph ph-plus-circle" onclick="openAddModal()"></i>
        </div>
    </header>

    <ul class="habit-list" id="habitList">
        </ul>
</div>

<div class="modal-overlay" id="addModal">
    <div class="modal-content">
        <h2>New Habit</h2>
        <label>Habit Name</label>
        <input type="text" id="habitNameInput" placeholder="e.g., Read 10 pages">
        
        <label>Frequency Type</label>
        <select id="freqType" onchange="toggleFreqOptions()">
            <option value="daily">Every Day</option>
            <option value="specific">Specific Days</option>
            <option value="weekly">N times a week</option>
        </select>

        <div id="specificDaysOpt" style="display:none;">
            <label>Select Days</label>
            <div class="days-selector">
                <label><input type="checkbox" class="day-chk" value="0"><span class="day-label">S</span></label>
                <label><input type="checkbox" class="day-chk" value="1"><span class="day-label">M</span></label>
                <label><input type="checkbox" class="day-chk" value="2"><span class="day-label">T</span></label>
                <label><input type="checkbox" class="day-chk" value="3"><span class="day-label">W</span></label>
                <label><input type="checkbox" class="day-chk" value="4"><span class="day-label">T</span></label>
                <label><input type="checkbox" class="day-chk" value="5"><span class="day-label">F</span></label>
                <label><input type="checkbox" class="day-chk" value="6"><span class="day-label">S</span></label>
            </div>
        </div>

        <div id="weeklyCountOpt" style="display:none;">
            <label>Times per Week</label>
            <select id="targetCount">
                <option value="1">1 time</option>
                <option value="2">2 times</option>
                <option value="3">3 times</option>
                <option value="4">4 times</option>
                <option value="5">5 times</option>
            </select>
        </div>

        <div class="btn-group">
            <button class="btn btn-cancel" onclick="closeModals()">Cancel</button>
            <button class="btn btn-primary" onclick="addHabit()">Save</button>
        </div>
    </div>
</div>

<div class="modal-overlay" id="themeModal">
    <div class="modal-content" style="text-align: center;">
        <h2>Pick a Theme</h2>
        <div class="theme-options">
            <div class="theme-circle" style="background:#ff8fa3;" onclick="setTheme('rose', this)"></div>
            <div class="theme-circle" style="background:#b39ddb;" onclick="setTheme('lavender', this)"></div>
            <div class="theme-circle" style="background:#80cbc4;" onclick="setTheme('mint', this)"></div>
            <div class="theme-circle" style="background:#ffcc80;" onclick="setTheme('peach', this)"></div>
        </div>
        <div class="btn-group">
            <button class="btn btn-cancel" onclick="closeModals()">Close</button>
        </div>
    </div>
</div>

<script>
    // --- Data Management ---
    let habits = JSON.parse(localStorage.getItem('myHabits')) || [];
    let currentTheme = localStorage.getItem('theme') || 'rose';

    // --- Initialization ---
    document.addEventListener('DOMContentLoaded', () => {
        renderDate();
        applyTheme(currentTheme);
        renderHabits();
    });

    // --- Rendering ---
    function renderDate() {
        const options = { weekday: 'long', month: 'short', day: 'numeric' };
        document.getElementById('currentDate').innerText = new Date().toLocaleDateString('en-US', options);
    }

    function renderHabits() {
        const list = document.getElementById('habitList');
        list.innerHTML = '';
        
        const today = new Date().getDay(); // 0-6
        const todayStr = new Date().toISOString().split('T')[0]; // YYYY-MM-DD

        habits.forEach((habit, index) => {
            // Logic to determine if habit should show today
            let shouldShow = false;
            let metaText = "";

            if (habit.type === 'daily') {
                shouldShow = true;
                metaText = "Every Day";
            } else if (habit.type === 'specific') {
                if (habit.days.includes(today.toString())) shouldShow = true;
                metaText = "Specific Days";
            } else if (habit.type === 'weekly') {
                shouldShow = true;
                metaText = `Goal: ${habit.target} / week`;
            }

            // Reset logic (Basic: reset daily based on lastChecked date)
            if (habit.lastChecked !== todayStr && habit.type !== 'weekly') {
                 habit.completed = false; 
            }
            // Note: Weekly reset logic is simplified here for a widget. 
            // Ideally, you check Monday-Sunday. Here we just track a counter.

            if (shouldShow) {
                const li = document.createElement('li');
                li.className = `habit-card ${habit.completed ? 'completed' : ''}`;
                
                let actionHTML = '';
                
                if (habit.type === 'weekly') {
                    actionHTML = `
                        <div class="counter-controls">
                            <span style="font-size:0.9rem; color:var(--accent-color); font-weight:600;">${habit.current || 0}/${habit.target}</span>
                            <button class="count-btn" onclick="incrementHabit(${index})"><i class="ph ph-plus"></i></button>
                        </div>
                    `;
                } else {
                    actionHTML = `
                        <div class="check-btn" onclick="toggleHabit(${index})">
                            <i class="ph ph-check" style="${habit.completed ? '' : 'display:none'}"></i>
                        </div>
                    `;
                }

                li.innerHTML = `
                    <div class="habit-info">
                        <i class="ph ph-sparkle habit-icon"></i>
                        <div class="habit-text">
                            <span class="habit-name">${habit.name}</span>
                            <span class="habit-meta">${metaText}</span>
                        </div>
                    </div>
                    <div style="display:flex; align-items:center;">
                        ${actionHTML}
                        <i class="ph ph-trash delete-btn" onclick="deleteHabit(${index})"></i>
                    </div>
                `;
                list.appendChild(li);
            }
        });
        saveData();
    }

    // --- Logic Functions ---
    function toggleHabit(index) {
        const todayStr = new Date().toISOString().split('T')[0];
        habits[index].completed = !habits[index].completed;
        habits[index].lastChecked = todayStr;
        renderHabits();
    }

    function incrementHabit(index) {
        if(!habits[index].current) habits[index].current = 0;
        habits[index].current++;
        
        // Check completion
        if(habits[index].current >= habits[index].target) {
            habits[index].completed = true;
        }
        renderHabits();
    }

    function addHabit() {
        const name = document.getElementById('habitNameInput').value;
        const type = document.getElementById('freqType').value;
        
        if (!name) return alert('Please enter a habit name');

        let newHabit = {
            name: name,
            type: type,
            completed: false,
            lastChecked: ''
        };

        if (type === 'specific') {
            const checkboxes = document.querySelectorAll('.day-chk:checked');
            newHabit.days = Array.from(checkboxes).map(cb => cb.value);
            if(newHabit.days.length === 0) return alert('Select at least one day');
        } else if (type === 'weekly') {
            newHabit.target = parseInt(document.getElementById('targetCount').value);
            newHabit.current = 0;
        }

        habits.push(newHabit);
        closeModals();
        document.getElementById('habitNameInput').value = ''; // reset
        renderHabits();
    }

    function deleteHabit(index) {
        if(confirm('Delete this habit?')) {
            habits.splice(index, 1);
            renderHabits();
        }
    }

    function saveData() {
        localStorage.setItem('myHabits', JSON.stringify(habits));
    }

    // --- UI Interaction ---
    function openAddModal() {
        document.getElementById('addModal').classList.add('active');
    }
    function openThemeModal() {
        document.getElementById('themeModal').classList.add('active');
    }
    function closeModals() {
        document.querySelectorAll('.modal-overlay').forEach(el => el.classList.remove('active'));
    }

    function toggleFreqOptions() {
        const type = document.getElementById('freqType').value;
        document.getElementById('specificDaysOpt').style.display = (type === 'specific') ? 'block' : 'none';
        document.getElementById('weeklyCountOpt').style.display = (type === 'weekly') ? 'block' : 'none';
    }

    // --- Theming ---
    function setTheme(themeName, element) {
        currentTheme = themeName;
        localStorage.setItem('theme', themeName);
        applyTheme(themeName);
        
        // Visual feedback in modal
        document.querySelectorAll('.theme-circle').forEach(el => el.classList.remove('selected'));
        if(element) element.classList.add('selected');
    }

    function applyTheme(themeName) {
        document.body.className = ''; // reset
        if (themeName !== 'rose') {
            document.body.classList.add(`theme-${themeName}`);
        }
    }
</script>

</body>
</html>
